/*!
 * tiny-virtual-list v0.0.1
 * open source under the MIT license
 * https://github.com/mfuu/tiny-virtual-list#readme
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).Virtual=i()}(this,(function(){"use strict";function t(){return t=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},t.apply(this,arguments)}function i(t,i){var e=null,n=function(){for(var n=this,s=arguments.length,o=new Array(s),r=0;r<s;r++)o[r]=arguments[r];e||(i<=0?t.apply(this,o):e=setTimeout((function(){e=null,t.apply(n,o)}),i))};return n.cancel=function(){e&&(clearTimeout(e),e=null)},n}function e(t,e){var n=i(t,e),s=function(){n.cancel(),n.apply(this,arguments)};return s.cancel=function(){n.cancel()},s}var n="front",s="behind",o={vertical:"top",horizontal:"left"},r={vertical:"scrollTop",horizontal:"scrollLeft"},l={vertical:"scrollHeight",horizontal:"scrollWidth"},h={vertical:"offsetHeight",horizontal:"offsetWidth"};function c(i,e){if(!i||!i.nodeType||1!==i.nodeType)throw"tiny-virtual-list: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=t({},e);var n={size:0,count:0,buffer:1,scroller:void 0,direction:"vertical",debounceTime:0,throttleTime:0};for(var s in n)!(s in this.options)&&(this.options[s]=n[s]);this.sizes=[],this.range={start:0,end:0,total:0,front:0,behind:0},this.offset=0,this.averageSize=0,this.scrollDirection="",this._updateScrollElement(),this._updateOnScrollFunction(),this._addScrollEventListener(),this.refresh()}return c.prototype={constructor:c,option:function(t,i){if(void 0===i)return this.options[t];var e,n,s,o=this.options[t];this.options[t]=i,"count"===t?this.refresh():"scroller"===t?(o&&(e=o,n="scroll",s=this._onScroll,window.removeEventListener?e.removeEventListener(n,s,!1):window.detachEvent?e.detachEvent("on"+n,s):e["on"+n]=null),this._updateScrollElement(),this._addScrollEventListener()):"throttleTime"!==t&&"debounceTime"!==t||this._updateOnScrollFunction()},refresh:function(){if(!this._invisible()){var t=Array.prototype.slice.call(this.el.children);if(t.length){var i=t[0];if(this.isFront()){var e=this._getElementSize(i)-this.getSize(this.range.start);this.scrollToOffset(this.offset+e)}this._updateSizes(t),this._updateRange()}}},isFront:function(){return this.scrollDirection===n},isBehind:function(){return this.scrollDirection===s},getSize:function(t){var i;return(null===(i=this.sizes[t])||void 0===i?void 0:i.size)||this.options.size||this.averageSize},getOffset:function(){return this.scrollEl[r[this.options.direction]]},getScrollSize:function(){return this.scrollEl[l[this.options.direction]]},getClientSize:function(){return this._getElementSize(this.scrollEl)},scrollToOffset:function(t){this.scrollEl[r[this.options.direction]]=t},scrollToIndex:function(t){if(t>this._getLastIndex())this.scrollToBottom();else{var i=this.sizes[t].front,e=this._getScrollStartOffset();this.scrollToOffset(i+e)}},scrollToBottom:function(){var t=this,i=this.getScrollSize();this.scrollToOffset(i),setTimeout((function(){var i=t.getClientSize(),e=t.getScrollSize();t.getOffset()+i+1<e&&t.scrollToBottom()}),5)},_updateScrollElement:function(){var t=this.options.scroller;t instanceof Document&&9===t.nodeType||t instanceof Window?this.scrollEl=document.scrollingElement||document.documentElement||document.body:this.scrollEl=t},_updateOnScrollFunction:function(){var t=this,n=this.options,s=n.debounceTime,o=n.throttleTime;this._onScroll=s?e((function(){return t._handleScroll()}),s):o?i((function(){return t._handleScroll()}),o):function(){return t._handleScroll()}},_addScrollEventListener:function(){var t,i,e;this.options.scroller&&(t=this.options.scroller,i="scroll",e=this._onScroll,window.addEventListener?t.addEventListener(i,e,!1):window.attachEvent?t.attachEvent("on"+i,e):t["on"+i]=e)},_handleScroll:function(){var t=this.getOffset(),i=this.getClientSize(),e=this.getScrollSize(),o=!!this.options.count&&t<=0,r=i+t+1>=e,l=t<this.offset?n:t>this.offset?s:"";this.offset=t,this.scrollDirection=l,this._dispatchEvent("onScroll",{top:o,bottom:r,offset:t,direction:l}),!l||this.isFront()&&0===this.range.start||this.isBehind()&&this.range.end===this._getLastIndex()||this._updateRange()},_updateRange:function(){if(0!==this.options.count&&!this._invisible()){!this.sizes.length&&this.refresh();var t=this._getRangeByOffset(),i=t.start,e=t.end;if(!(i===this.range.start&&e===this.range.end||this.isFront()&&i>this.range.start||this.isBehind()&&i<this.range.start)){var n=this._getTotalSize(),s=this.sizes[i].front,o=n-this.sizes[e].behind;this.range.start=i,this.range.end=e,this.range.total=n,this.range.front=s,this.range.behind=o,this._dispatchEvent("onUpdate",this.range)}}},_updateSizes:function(t){for(var i=0,e=this.range.start,n=0;n<t.length;n++){var s,o=this._getElementSize(t[n]);if(o){var r=(null===(s=this.sizes[e-1])||void 0===s?void 0:s.behind)||0,l=r+o;this.sizes[e]={size:o,front:r,behind:l},i+=o,e+=1}}var h=i/(e-this.range.start);this.averageSize=Math.round(this.averageSize?(h+this.averageSize)/2:h),this.sizes.length=this.options.count;for(var c=this.range.end+1;c<this.options.count;c++){var a,f=this.getSize(c),u=(null===(a=this.sizes[c-1])||void 0===a?void 0:a.behind)||0,d=u+f;this.sizes[c]={size:f,front:u,behind:d}}},_getTotalSize:function(){var t;return(null===(t=this.sizes[this._getLastIndex()])||void 0===t?void 0:t.behind)||0},_getLastIndex:function(){return Math.max(0,this.options.count-1)},_getElementSize:function(t){return Math.round(t[h[this.options.direction]])},_getRangeByOffset:function(){for(var t=this.getClientSize(),i=this.offset-this._getScrollStartOffset(),e=this._getIndexByOffset(i),n=e,s=0,o=this.options,r=o.count,l=o.buffer;n<r&&(s+=this.sizes[n].size,n+=1,!(s>t)););return{start:e=Math.max(0,e-l),end:n=Math.min(this._getLastIndex(),n+l)}},_getIndexByOffset:function(t){for(var i=0,e=this.sizes.length-1;i<=e;){var n=Math.floor((i+e)/2),s=this.sizes[n],o=s.front,r=s.behind;if(t>=o&&t<=r){e=n;break}t>r?i=n+1:t<o&&(e=n-1)}return e>0?e:0},_getScrollStartOffset:function(){var t=0,i=this.options,e=i.scroller,n=i.direction;if(e&&this.el){var s=o[n],r=this.el.getBoundingClientRect(),l=e===window?{}:e.getBoundingClientRect();t=this.offset+r[s]-(l[s]||0)}return t},_dispatchEvent:function(t,i){var e=this.options[t];"function"==typeof e&&e(i)},_invisible:function(){return 0===this.el.offsetWidth||0===this.el.offsetHeight}},c.utils={debounce:e,throttle:i},c}));
