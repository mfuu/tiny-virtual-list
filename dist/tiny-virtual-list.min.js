/*!
 * tiny-virtual-list v0.0.3
 * open source under the MIT license
 * https://github.com/mfuu/tiny-virtual-list#readme
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).Virtual=i()}(this,(function(){"use strict";function t(){return t=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},t.apply(this,arguments)}function i(t,i,e){window.removeEventListener?t.removeEventListener(i,e,!1):window.detachEvent?t.detachEvent("on"+i,e):t["on"+i]=null}function e(t,i){var e=null,n=function(){for(var n=this,o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];e||(i<=0?t.apply(this,s):e=setTimeout((function(){e=null,t.apply(n,s)}),i))};return n.cancel=function(){e&&(clearTimeout(e),e=null)},n}function n(t,i){var n=e(t,i),o=function(){n.cancel(),n.apply(this,arguments)};return o.cancel=function(){n.cancel()},o}var o={attributes:!1,childList:!0,subtree:!1},s="front",r="behind",l={vertical:"top",horizontal:"left"},h={vertical:"scrollTop",horizontal:"scrollLeft"},c={vertical:"scrollHeight",horizontal:"scrollWidth"},a={vertical:"offsetHeight",horizontal:"offsetWidth"};function f(i,e){if(!i||!i.nodeType||1!==i.nodeType)throw"tiny-virtual-list: `el` must be an HTMLElement, not ".concat({}.toString.call(i));this.el=i,this.options=e=t({},e);var n={size:0,count:0,buffer:1,scroller:void 0,direction:"vertical",debounceTime:0,throttleTime:0};for(var o in n)!(o in this.options)&&(this.options[o]=n[o]);this.sizes=[],this.range={start:0,end:0,total:0,front:0,behind:0},this.offset=0,this.averageSize=0,this.scrollDirection="",this._updateScrollElement(),this._updateOnScrollFunction(),this.refresh(),this.updateRange(),this.addScrollEventListener()}return f.prototype={constructor:f,destroy:function(){var t;this.removeScrollEventListener(),null===(t=this.observer)||void 0===t||t.disconnect()},option:function(t,e){if(void 0===e)return this.options[t];var n=this.options[t];this.options[t]=e,"count"===t?this._updateAfterEndSizes():"scroller"===t?(n&&i(n,"scroll",this._onScroll),this._updateScrollElement(),this.addScrollEventListener()):"throttleTime"!==t&&"debounceTime"!==t||this._updateOnScrollFunction()},refresh:function(){if(!this._invisible()){var t=Array.prototype.slice.call(this.el.children);if(t.length){var i=t[0];if(this.isFront()){var e=this._getElementSize(i)-this.getSize(this.range.start);this.scrollToOffset(this.offset+e)}this._updateSizes(t),this._updateAfterEndSizes()}}},updateRange:function(i){i=void 0===i?this.range.start:i;var e=this._getEndByStart(i),n=this._getTotalSize(),o=this._getPosition(i,s),l=n-this._getPosition(e,r);l!==this.range.behind&&(this.range.start=i,this.range.end=e,this.range.total=n,this.range.front=o,this.range.behind=l,this._dispatchEvent("onUpdate",t({},this.range)))},isFront:function(){return this.scrollDirection===s},isBehind:function(){return this.scrollDirection===r},getSize:function(t){var i;return(null===(i=this.sizes[t])||void 0===i?void 0:i.size)||this.options.size||this.averageSize},getOffset:function(){return this.scrollEl[h[this.options.direction]]},getScrollSize:function(){return this.scrollEl[c[this.options.direction]]},getClientSize:function(){return this._getElementSize(this.scrollEl)},scrollToOffset:function(t){this.scrollEl[h[this.options.direction]]=t},scrollToIndex:function(t){if(t>this._getLastIndex())this.scrollToBottom();else{var i=this._getPosition(t,s),e=this._getScrollStartOffset();this.scrollToOffset(i+e)}},scrollToBottom:function(){var t=this,i=this.getScrollSize();this.scrollToOffset(i),setTimeout((function(){var i=t.getClientSize(),e=t.getScrollSize();t.getOffset()+i+1<e&&t.scrollToBottom()}),5)},addScrollEventListener:function(){var t,i,e;this.options.scroller&&(t=this.options.scroller,i="scroll",e=this._onScroll,window.addEventListener?t.addEventListener(i,e,!1):window.attachEvent?t.attachEvent("on"+i,e):t["on"+i]=e)},removeScrollEventListener:function(){this.options.scroller&&i(this.options.scroller,"scroll",this._onScroll)},_installObserve:function(){var t=this,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;i&&(this.observer=new i((function(){return t.refresh()})),this.observer.observe(this.el,o))},_updateScrollElement:function(){var t=this.options.scroller;t instanceof Document&&9===t.nodeType||t instanceof Window?this.scrollEl=document.scrollingElement||document.documentElement||document.body:this.scrollEl=t},_updateOnScrollFunction:function(){var t=this,i=this.options,o=i.debounceTime,s=i.throttleTime;this._onScroll=o?n((function(){return t._handleScroll()}),o):s?e((function(){return t._handleScroll()}),s):function(){return t._handleScroll()}},_handleScroll:function(){var t=this.getOffset(),i=this.getClientSize(),e=this.getScrollSize(),n=!!this.options.count&&t<=0,o=i+t+1>=e,l=t<this.offset?s:t>this.offset?r:"";if(this.offset=t,this.scrollDirection=l,this._dispatchEvent("onScroll",{top:n,bottom:o,offset:t,direction:l}),!(!l||this._invisible()||this.options.count<=0||this.isFront()&&0===this.range.start||this.isBehind()&&this.range.end===this._getLastIndex())){!this.sizes.length&&this.refresh();var h=this.offset-this._getScrollStartOffset(),c=this._getIndexByOffset(h);c=Math.max(0,c-this.options.buffer),this.isFront()&&c>this.range.start||this.isBehind()&&c<this.range.start||this.updateRange(c)}},_updateSizes:function(t){for(var i=0,e=this.range.start,n=0;n<t.length;n++){var o=this._getElementSize(t[n]);if(o){var s=this._getPosition(e-1,r),l=s+o;this.sizes[e]={size:o,front:s,behind:l},i+=o,e+=1}}var h=i/(e-this.range.start);this.averageSize=Math.round(this.averageSize?(h+this.averageSize)/2:h)},_updateAfterEndSizes:function(){if(this.sizes.length=this.options.count,!(this.range.end>=this.options.count))for(var t=this.range.end+1;t<this.options.count;t++){var i=this.getSize(t),e=this._getPosition(t-1,r),n=e+i;this.sizes[t]={size:i,front:e,behind:n}}},_getPosition:function(t,i){var e=this.sizes[t];return e?e[i]:0},_getTotalSize:function(){return this._getPosition(this._getLastIndex(),r)},_getLastIndex:function(){return Math.max(0,this.options.count-1)},_getElementSize:function(t){return Math.round(t[a[this.options.direction]])},_getEndByStart:function(t){for(var i=this.getClientSize(),e=t,n=0,o=this.options,s=o.count,r=o.buffer;e<s&&(n+=this.getSize(e),e+=1,!(n>i)););return e=Math.min(this._getLastIndex(),e+r)},_getIndexByOffset:function(t){for(var i=0,e=this.sizes.length-1;i<=e;){var n=Math.floor((i+e)/2),o=this.sizes[n],s=o.front,r=o.behind;if(t>=s&&t<=r){e=n;break}t>r?i=n+1:t<s&&(e=n-1)}return e>0?e:0},_getScrollStartOffset:function(){var t=0,i=this.options,e=i.scroller,n=i.direction;if(e&&this.el){var o=l[n],s=this.el.getBoundingClientRect(),r=e===window?{}:e.getBoundingClientRect();t=this.offset+s[o]-(r[o]||0)}return t},_dispatchEvent:function(t,i){var e=this.options[t];"function"==typeof e&&e(i)},_invisible:function(){return 0===this.el.offsetWidth||0===this.el.offsetHeight}},f.utils={debounce:n,throttle:e},f}));
