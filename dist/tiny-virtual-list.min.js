/*!
 * tiny-virtual-list v0.0.1
 * open source under the MIT license
 * https://github.com/mfuu/tiny-virtual-list#readme
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Virtual=e()}(this,(function(){"use strict";function t(t,e){var i=null,n=function(){for(var n=this,o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];i||(e<=0?t.apply(this,s):i=setTimeout((function(){i=void 0,t.apply(n,s)}),e))};return n.cancel=function(){i&&(clearTimeout(i),i=null)},n}function e(e,i){var n=t(e,i),o=function(){n.cancel(),n.apply(this,arguments)};return o.cancel=function(){n.cancel()},o}var i="front",n="behind",o={vertical:"top",horizontal:"left"},s={vertical:"scrollTop",horizontal:"scrollLeft"},r={vertical:"scrollHeight",horizontal:"scrollWidth"},l={vertical:"offsetHeight",horizontal:"offsetWidth"};function h(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"tiny-virtual-list: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=Object.assign({},e);var i={count:0,buffer:1,scroller:null,direction:"vertical",debounceTime:null,throttleTime:null};for(var n in i)!(n in this.options)&&(this.options[n]=i[n]);this.sizes=[],this.range={start:0,end:0,total:0,front:0,behind:0},this.offset=0,this.averageSize=0,this.scrollDirection="",this._updateScrollElement(),this._updateOnScrollFunction(),this._addScrollEventListener(),this.refresh()}return h.prototype={constructor:h,option:function(t,e){if(void 0===e)return this.options[t];var i,n,o,s=this.options[t];this.options[t]=e,"count"===t?this.refresh():"scroller"===t?(s&&(i=s,n="scroll",o=this._onScroll,window.removeEventListener?i.removeEventListener(n,o,!1):window.detachEvent?i.detachEvent("on"+n,o):i["on"+n]=null),this._updateScrollElement(),this._addScrollEventListener()):"throttleTime"!==t&&"debounceTime"!==t||this._updateOnScrollFunction()},refresh:function(){if(0!==this.el.offsetHeight&&0!==this.el.offsetWidth){var t=Array.prototype.slice.call(this.el.children);if(t.length){var e=t[0];if(this.scrollDirection===i){var n=this._getElementSize(e)-this.getSize(this.range.start);this.scrollToOffset(this.offset+n)}for(var o=0,s=this.range.start,r=0;r<t.length;r++){var l,h=this._getElementSize(t[r]);if(h){var c=(null===(l=this.sizes[s-1])||void 0===l?void 0:l.behind)||0,a=c+h;this.sizes[s]={size:h,front:c,behind:a},o+=h,s+=1}}var f=o/(s-this.range.start);this.averageSize=Math.round(this.averageSize?(f+this.averageSize)/2:f),this._updateSizes(),this._updateRange()}}},getSize:function(t){var e;return(null===(e=this.sizes[t])||void 0===e?void 0:e.size)||this.averageSize},getOffset:function(){return this.scrollEl[s[this.options.direction]]},getScrollSize:function(){return this.scrollEl[r[this.options.direction]]},getClientSize:function(){return this._getElementSize(this.scrollEl)},scrollToOffset:function(t){this.scrollEl[s[this.options.direction]]=t},scrollToIndex:function(t){if(t>this._getLastIndex())this.scrollToBottom();else{var e=this.sizes[t].front,i=this._getScrollStartOffset();this.scrollToOffset(e+i)}},scrollToBottom:function(){var t=this,e=this.getScrollSize();this.scrollToOffset(e),setTimeout((function(){var e=t.getClientSize(),i=t.getScrollSize();t.getOffset()+e+1<i&&t.scrollToBottom()}),5)},_updateScrollElement:function(){var t=this.options.scroller;t instanceof Document&&9===t.nodeType||t instanceof Window?this.scrollEl=document.scrollingElement||document.documentElement||document.body:this.scrollEl=t},_updateOnScrollFunction:function(){var i=this,n=this.options,o=n.debounceTime,s=n.throttleTime;this._onScroll=o?e((function(){return i._handleScroll()}),o):s?t((function(){return i._handleScroll()}),s):function(){return i._handleScroll()}},_addScrollEventListener:function(){var t,e,i;this.options.scroller&&(t=this.options.scroller,e="scroll",i=this._onScroll,window.addEventListener?t.addEventListener(e,i,!1):window.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i)},_handleScroll:function(){var t=this.getOffset(),e=this.getClientSize(),o=this.getScrollSize(),s=!!this.options.count&&t<=0,r=e+t+1>=o,l=t<this.offset?i:t>this.offset?n:"";this.offset=t,this.scrollDirection=l,this._dispatchEvent("onScroll",{top:s,bottom:r,offset:t,direction:l}),!l||l===i&&0===this.range.start||l===n&&this.range.end===this._getLastIndex()||this._updateRange()},_updateRange:function(){if(0!==this.options.count&&0!==this.el.offsetWidth&&0!==this.el.offsetHeight){!this.sizes.length&&this.refresh();var t=this._getRangeByOffset(),e=t.start,i=t.end;if(e!==this.range.start||i!==this.range.end){var n=this._getTotalSize(),o=this.sizes[e].front,s=n-this.sizes[i].behind;this.range.start=e,this.range.end=i,this.range.total=n,this.range.front=o,this.range.behind=s,this._dispatchEvent("onUpdate",this.range)}}},_updateSizes:function(){this.sizes.length=this.options.count;for(var t=this.range.end+1;t<this.options.count;t++){var e,i=this.getSize(t),n=(null===(e=this.sizes[t-1])||void 0===e?void 0:e.behind)||0,o=n+i;this.sizes[t]={size:i,front:n,behind:o}}},_getRangeByOffset:function(){for(var t=this.getClientSize(),e=this.offset-this._getScrollStartOffset(),i=this._getIndexByOffset(e),n=i,o=0,s=this.options,r=s.count,l=s.buffer;n<r&&(o+=this.sizes[n].size,n+=1,!(o>t)););return{start:i=Math.max(0,i-l),end:n=Math.min(this._getLastIndex(),n+l)}},_getTotalSize:function(){var t;return(null===(t=this.sizes[this._getLastIndex()])||void 0===t?void 0:t.behind)||0},_getLastIndex:function(){return Math.max(0,this.options.count-1)},_getElementSize:function(t){return Math.round(t[l[this.options.direction]])},_getIndexByOffset:function(t){for(var e=0,i=this.sizes.length-1;e<=i;){var n=Math.floor((e+i)/2),o=this.sizes[n],s=o.front,r=o.behind;if(t>=s&&t<=r){i=n;break}t>r?e=n+1:t<s&&(i=n-1)}return Math.max(i,0)},_getScrollStartOffset:function(){var t=0,e=this.options,i=e.scroller,n=e.direction;if(i&&this.el){var s=o[n],r=this.el.getBoundingClientRect(),l=i===window?{}:i.getBoundingClientRect();t=this.offset+r[s]-(l[s]||0)}return t},_dispatchEvent:function(t,e){var i=this.options[t];"function"==typeof i&&i(e)}},h.utils={debounce:e,throttle:t},h}));
